<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HanjaPass - Minimalist Edu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        body { background: #fcfdfe; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        .word-card { background: white; border-radius: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.02); border: 1.5px solid #f1f5f9; position: relative; }
        .active-tab { background: #6366f1 !important; color: white !important; transform: scale(1.05); }
        .tab-btn { flex: 1; padding: 14px 0; border-radius: 20px; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: #94a3b8; font-weight: 800; font-size: 13px; }
        
        /* æ‹¼éŸ³æˆ´åœ¨æ±‰å­—å¤´é¡¶çš„æ ·å¼ */
        .pinyin-top { font-size: 14px; font-weight: 700; color: #94a3b8; line-height: 1; margin-bottom: 4px; font-family: Arial, sans-serif; }
        .hanzi-main { font-size: 52px; font-weight: 900; color: #1e293b; line-height: 1.1; cursor: pointer; transition: transform 0.2s; }
        .hanzi-main:active { transform: scale(0.95); }
        
        /* ç¬”é¡ºåŸä½å®¹å™¨ */
        .writer-container { width: 100px; height: 100px; cursor: pointer; }
        
        .paywall-overlay { position: absolute; inset: 0; background: rgba(255, 255, 255, 0.96); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 50; border-radius: 40px; }
    </style>
</head>
<body class="p-5 max-w-md mx-auto pb-24">

    <div class="flex items-center justify-between mb-8 mt-4">
        <div class="flex items-center gap-2">
            <span class="text-3xl">ğŸ¼</span>
            <h1 class="text-xl font-black text-slate-800 tracking-tighter">HanjaPass</h1>
        </div>
        <select id="voiceSet" class="bg-slate-100 text-slate-600 text-[11px] font-bold p-2 rounded-xl border-none outline-none">
            <option value="child">ğŸ­ ì–´ë¦°ì´ (Cute)</option>
            <option value="pro">ğŸ™ï¸ ì•„ë‚˜ìš´ì„œ (Pro)</option>
        </select>
    </div>

    <div id="tabBar" class="flex bg-slate-100 p-1.5 rounded-[22px] mb-8 font-bold text-xs"></div>

    <div id="container" class="space-y-6"></div>

    <script>
        let globalData = {};
        const FREE_LIMIT = 5;

        async function initApp() {
            try {
                const response = await fetch('data.json');
                globalData = await response.json();
                createTabs();
                render(Object.keys(globalData)[0]);
            } catch (e) { console.error("Data error"); }
        }

        function createTabs() {
            const tabBar = document.getElementById('tabBar');
            Object.keys(globalData).forEach(mode => {
                const btn = document.createElement('button');
                btn.className = 'tab-btn';
                btn.id = `tab-${mode}`;
                btn.innerText = mode.toUpperCase();
                btn.onclick = () => render(mode);
                tabBar.appendChild(btn);
            });
        }

        function render(mode) {
            const list = document.getElementById('container');
            list.innerHTML = '';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById(`tab-${mode}`).classList.add('active-tab');

            globalData[mode].forEach((item, index) => {
                const isLocked = index >= FREE_LIMIT;
                const card = document.createElement('div');
                card.className = 'word-card p-6 mb-4';

                // ç¹ä½“å¤„ç†é€»è¾‘
                const traditional = (item.hj && item.hj !== item.cn) ? ` <span class="text-slate-300 font-normal">(${item.hj})</span>` : '';

                let html = `
                    <div class="${isLocked ? 'blur-md pointer-events-none' : ''}">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex flex-col items-center flex-1 pr-4 border-r border-slate-50" onclick="play('${item.cn}')">
                                <div class="pinyin-top">${item.py}</div>
                                <div class="hanzi-main">${item.cn}</div>
                                <div class="mt-3 text-center">
                                    <span class="text-rose-500 font-black text-lg">${item.trans}</span>
                                    <span class="text-sm">${traditional}</span>
                                </div>
                                <div class="mt-1 text-[13px] font-bold text-slate-400 italic">${item.kr}</div>
                            </div>
                            
                            <div class="flex flex-col items-center gap-2">
                                <div id="writer-${mode}-${index}" class="writer-container" onclick="drawInPlace('${item.cn}', 'writer-${mode}-${index}')"></div>
                                <span class="text-[9px] font-black text-orange-500 bg-orange-50 px-2 py-0.5 rounded-full">ì“°ê¸° ë³´ê¸°</span>
                            </div>
                        </div>

                        <div class="bg-indigo-50/50 p-5 rounded-[30px] border border-indigo-100/30 relative">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-[9px] font-black text-indigo-400 uppercase tracking-tighter">Real Scene</span>
                                ${item.video_url ? `
                                    <button onclick="window.open('${item.video_url}')" class="text-rose-500"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M4.5 3.5v13L16 10z"/></svg></button>
                                ` : ''}
                            </div>
                            <p class="text-slate-500 text-[11px] font-bold mb-2">"${item.sentence_kr}"</p>
                            <div onclick="play('${item.sentence_cn}')" class="cursor-pointer">
                                <p class="text-slate-900 font-black text-base leading-tight">${item.sentence_cn}</p>
                                <p class="text-[10px] font-bold text-slate-400 mt-1">${item.sentence_py}</p>
                                <p class="text-rose-500 text-xs font-black mt-1">${item.sentence_read}</p>
                            </div>
                        </div>
                    </div>
                `;

                if (isLocked) {
                    html += `
                        <div class="paywall-overlay">
                            <div class="text-center">
                                <span class="text-2xl mb-2 block">ğŸ”’</span>
                                <button onclick="alert('Join Membership')" class="bg-indigo-600 text-white px-6 py-2.5 rounded-2xl font-bold text-sm shadow-xl shadow-indigo-200">ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸°</button>
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = html;
                list.appendChild(card);
                
                // é¡µé¢åŠ è½½åç«‹å³åˆå§‹åŒ–ç¬”é¡ºé™æ­¢çŠ¶æ€
                setTimeout(() => initWriter(item.cn[0], `writer-${mode}-${index}`), 100);
            });
        }

        // åˆå§‹åŒ–ç¬”é¡ºé™æ­¢å›¾
        function initWriter(char, elementId) {
            const el = document.getElementById(elementId);
            if(!el) return;
            el.innerHTML = '';
            HanziWriter.create(elementId, char, {
                width: 100, height: 100, padding: 5,
                strokeColor: '#e2e8f0', // é»˜è®¤ç°è‰²ï¼Œåƒä¸ªåº•ç¨¿
                showOutline: true
            });
        }

        // ç‚¹å‡»åŸä½æ’­æ”¾ç¬”é¡ºåŠ¨ç”»
        async function drawInPlace(word, elementId) {
            const el = document.getElementById(elementId);
            for (let char of word) {
                el.innerHTML = '';
                const writer = HanziWriter.create(elementId, char, {
                    width: 100, height: 100, padding: 5,
                    strokeColor: '#6366f1', // æ’­æ”¾æ—¶ç”¨ç´«è‰²
                    radicalColor: '#f43f5e',
                    strokeAnimationSpeed: 2,
                    delayBetweenStrokes: 100
                });
                await writer.animateCharacter();
                await new Promise(r => setTimeout(r, 600));
            }
        }

        function play(text) {
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            const mode = document.getElementById('voiceSet').value;
            utter.lang = 'zh-CN';
            if (mode === 'child') { utter.pitch = 1.6; utter.rate = 1.1; }
            else { utter.pitch = 0.95; utter.rate = 0.85; }
            window.speechSynthesis.speak(utter);
        }

        initApp();
    </script>
</body>
</html>
