<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í•œì ì„ ìƒë‹˜</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#fffaf5; }
    .ai-box {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 320px;
      max-height: 420px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      display: none;
      flex-direction: column;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }
    .ai-header {
      background:#1f2937;
      color:#fff;
      padding:10px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .ai-body {
      flex:1;
      padding:12px;
      overflow-y:auto;
      font-size:14px;
    }
    .ai-footer {
      display:flex;
      gap:8px;
      padding:10px;
      border-top:1px solid #eee;
    }
    .ai-msg {
      margin-bottom:8px;
      line-height:1.5;
      white-space:pre-wrap;
    }
    .user { text-align:right; }
    .ai { text-align:left; color:#111; }
    .fab {
      position:fixed;
      bottom:20px;
      right:20px;
      width:56px;
      height:56px;
      border-radius:50%;
      background:#111827;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      cursor:pointer;
      box-shadow:0 6px 20px rgba(0,0,0,.25);
    }
  </style>
</head>

<body>

<!-- AI CHAT -->
<div id="aiBox" class="ai-box">
  <div class="ai-header">
    <div>ğŸ¤– AI í•œì ì„ ìƒë‹˜</div>
    <button onclick="toggleAI()">âœ•</button>
  </div>
  <div id="chat" class="ai-body"></div>
  <div class="ai-footer">
    <input id="aiInput" class="flex-1 border rounded px-2 py-1" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”â€¦" />
    <button onclick="askAI()" class="bg-orange-500 text-white px-3 rounded">â–¶</button>
  </div>
</div>

<!-- FAB -->
<div class="fab" onclick="toggleAI()">ğŸ¤–</div>

<script>
/* ================== CONFIG ================== */
// âœ… è¿™é‡Œæ¢æˆä½ ã€æ–°çš„ã€å—ä¿æŠ¤çš„ã€‘API KEY
const GEMINI_KEY = "AIzaSyBgRz67t10Rvuy-4L4OwKkwKuA2XUhI_n4";
const GEMINI_MODEL = "gemini-flash-latest";

const API_URL =
  `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_KEY}`;
/* ============================================ */

function toggleAI() {
  const box = document.getElementById("aiBox");
  box.style.display = box.style.display === "flex" ? "none" : "flex";
  if (box.style.display === "flex" && !box.dataset.init) {
    addMessage("ì•ˆë…•í•˜ì„¸ìš”! ğŸ˜Š\nHSK í•œì ì„ ìƒë‹˜ì…ë‹ˆë‹¤.\në¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?", "ai");
    box.dataset.init = "1";
  }
}

function addMessage(text, role) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = `ai-msg ${role}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function askAI() {
  const input = document.getElementById("aiInput");
  const msg = input.value.trim();
  if (!msg) return;

  addMessage(msg, "user");
  input.value = "";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [
          {
            role: "user",
            parts: [
              { text: `ë‹¹ì‹ ì€ HSK ì¤‘êµ­ì–´Â·í•œì ì „ë¬¸ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.\ní•œêµ­ í•™ìŠµìì—ê²Œ ì¹œì ˆí•˜ê²Œ ì„¤ëª…í•˜ì„¸ìš”.\n\nì§ˆë¬¸: ${msg}` }
            ]
          }
        ]
      })
    });

    const data = await res.json();

    const answer =
      data?.candidates?.[0]?.content?.parts?.[0]?.text;

    if (!answer) {
      addMessage("âŒ ë‹µë³€ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n(ì‘ë‹µ í˜•ì‹ì´ ì˜ˆìƒê³¼ ë‹¬ë¼ìš”)", "ai");
      console.error(data);
      return;
    }

    addMessage(answer, "ai");

  } catch (e) {
    console.error(e);
    addMessage("âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.", "ai");
  }
}
</script>

</body>
</html>
