<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HanjaPass - Full Jelly Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        body { background: #fffaf5; font-family: 'Malgun Gothic', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* ç»Ÿä¸€çš„æœå†»æ‹Ÿæ€é£æ ¼ */
        .jelly-box {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 40px;
            box-shadow: 8px 8px 16px #ebebeb, -8px -8px 16px #ffffff, inset 0 0 15px rgba(255,255,255,0.6);
            border: 2px solid rgba(255,255,255,0.8);
            position: relative; cursor: pointer; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .jelly-box:active { transform: scale(0.96); box-shadow: 2px 2px 5px #ebebeb, inset 2px 2px 5px rgba(0,0,0,0.05); }

        /* Click! å‘¼å¸æ ‡ç­¾ */
        .click-badge {
            position: absolute; top: -8px; right: -5px;
            background: #ff7e5f; color: white; font-size: 9px; font-weight: 900;
            padding: 3px 10px; border-radius: 20px; box-shadow: 0 4px 8px rgba(255,126,95,0.3);
            animation: pulse 1.8s infinite; z-index: 10;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* æ‹¼éŸ³æ ·å¼ï¼šå¤§å†™ã€æ©˜è‰²ã€é—´è· */
        .pinyin-style {
            font-size: 26px; font-weight: 900; color: #ff6b00;
            letter-spacing: 0.2em; text-transform: lowercase;
            margin-bottom: 8px; font-family: 'Arial Rounded MT Bold', sans-serif;
        }

        .word-card { background: white; border-radius: 55px; border: 6px solid #fff1e6; }
        .active-tab { background: #ff7e5f !important; color: white !important; }
        .tab-btn { flex: 1; padding: 15px; border-radius: 25px; color: #ffbfa0; font-weight: 900; background: #fff5f0; font-size: 14px; }
    </style>
</head>
<body class="p-6 max-w-md mx-auto pb-24">

    <div class="text-center mb-10">
        <div class="inline-block p-4 bg-white rounded-[30px] shadow-sm mb-4">
            <h1 class="text-2xl font-black text-slate-800">ğŸ¼ HanjaPass <span class="text-orange-500">Premium</span></h1>
        </div>
        <div class="px-8">
            <select id="voiceSet" class="w-full bg-white border-4 border-orange-50 text-orange-400 font-black p-3 rounded-[25px] outline-none appearance-none cursor-pointer text-center text-sm">
                <option value="child">ğŸ­ ìº”ë”” ë³´ì´ìŠ¤ (Candy)</option>
                <option value="pro">ğŸ™ï¸ ì•„ë‚˜ìš´ì„œ (Pro)</option>
            </select>
        </div>
    </div>

    <div id="tabBar" class="flex gap-2 mb-10"></div>
    <div id="container" class="space-y-12"></div>

    <script>
        let globalData = {};
        const FREE_LIMIT = 5;

        async function initApp() {
            try {
                const response = await fetch('data.json');
                globalData = await response.json();
                createTabs();
                render(Object.keys(globalData)[0]);
            } catch (e) { console.error("Data loading error"); }
        }

        function createTabs() {
            const tabBar = document.getElementById('tabBar');
            Object.keys(globalData).forEach(mode => {
                const btn = document.createElement('button');
                btn.className = 'tab-btn';
                btn.id = `tab-${mode}`;
                btn.innerText = mode.toUpperCase();
                btn.onclick = () => render(mode);
                tabBar.appendChild(btn);
            });
        }

        function render(mode) {
            const list = document.getElementById('container');
            list.innerHTML = '';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById(`tab-${mode}`).classList.add('active-tab');

            globalData[mode].forEach((item, index) => {
                const isLocked = index >= FREE_LIMIT;
                const card = document.createElement('div');
                card.className = 'word-card p-8 relative';
                
                const traditional = (item.hj && item.hj !== item.cn) ? `<span class="text-slate-200">(${item.hj})</span>` : '';

                card.innerHTML = `
                    <div class="${isLocked ? 'blur-2xl opacity-40 pointer-events-none' : ''}">
                        <div class="flex flex-col items-center mb-12">
                            <div class="pinyin-style">${item.py.toLowerCase()}</div>
                            <div class="jelly-box px-12 py-6" onclick="play('${item.cn}')">
                                <div class="click-badge">CLICK!</div>
                                <span class="text-7xl font-black text-slate-800">${item.cn}</span>
                            </div>
                            <div class="mt-6 text-center">
                                <p class="text-2xl font-black text-rose-500 underline decoration-orange-200 underline-offset-8">${item.trans} ${traditional}</p>
                                <p class="text-lg font-black text-orange-300 mt-2 italic">/ ${item.kr} /</p>
                            </div>
                        </div>

                        <div class="flex flex-col items-center mb-12">
                            <div id="writer-${mode}-${index}" class="jelly-box w-40 h-40 flex items-center justify-center bg-white" onclick="draw('${item.cn}', 'writer-${mode}-${index}')">
                                <div class="click-badge">WRITE!</div>
                            </div>
                        </div>

                        <div class="jelly-box p-8 bg-white" onclick="play('${item.sentence_cn}')">
                            <div class="click-badge">LISTEN!</div>
                            <p class="text-slate-400 text-xs font-bold mb-4 italic">"${item.sentence_kr}"</p>
                            <p class="text-3xl font-black text-slate-800 leading-tight">${item.sentence_cn}</p>
                            <p class="text-orange-500 font-black text-sm mt-3">${item.sentence_py.toLowerCase()}</p>
                            <p class="text-rose-400 font-black text-xl mt-1">${item.sentence_read}</p>
                        </div>
                    </div>
                `;
                list.appendChild(card);
                // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªå­—çš„åº•ç¨¿
                setTimeout(() => initWriter(item.cn[0], `writer-${mode}-${index}`), 100);
            });
        }

        function initWriter(char, el) { 
            const container = document.getElementById(el);
            if(!container) return;
            container.innerHTML = '<div class="click-badge">WRITE!</div>';
            HanziWriter.create(el, char, { width: 130, height: 130, padding: 15, strokeColor: '#f1f1f1', showOutline: true }); 
        }
        
        async function draw(word, el) {
            const container = document.getElementById(el);
            // å¾ªç¯æ’­æ”¾å•è¯é‡Œçš„æ¯ä¸€ä¸ªæ±‰å­—
            for (let char of word) {
                container.innerHTML = '<div class="click-badge">WRITE!</div>';
                const writer = HanziWriter.create(el, char, { width: 130, height: 130, padding: 15, strokeColor: '#ff7e5f', radicalColor: '#4338ca', strokeAnimationSpeed: 2.5 });
                await writer.animateCharacter();
                await new Promise(r => setTimeout(r, 800)); // æ¯ä¸ªå­—ä¸­é—´åœé¡¿
            }
            // æ’­å®Œåæ¢å¤ç¬¬ä¸€ä¸ªå­—çš„åº•ç¨¿
            initWriter(word[0], el);
        }

        function play(text) {
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            const mode = document.getElementById('voiceSet').value;
            utter.lang = 'zh-CN';
            utter.pitch = (mode === 'child') ? 2.0 : 0.9;
            utter.rate = (mode === 'child') ? 1.0 : 0.8;
            window.speechSynthesis.speak(utter);
        }

        initApp();
    </script>
</body>
</html>
