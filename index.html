<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í•œì ì„ ìƒë‹˜ Â· HanjaPass</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDNï¼ˆç°åœ¨é˜¶æ®µå¯ä»¥ç”¨ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #f9fafb;
      font-family: "Malgun Gothic", "Apple SD Gothic Neo", sans-serif;
    }
    .chat-bubble {
      max-width: 75%;
      padding: 10px 14px;
      border-radius: 14px;
      margin-bottom: 8px;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    .user {
      background: #f59e0b;
      color: white;
      margin-left: auto;
    }
    .ai {
      background: #e5e7eb;
      color: #111827;
      margin-right: auto;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center">

  <!-- Floating Button -->
  <div id="ai-fab"
       class="fixed bottom-6 right-6 w-12 h-12 bg-black text-white rounded-full flex items-center justify-center cursor-pointer shadow-lg"
       onclick="toggleAI()">
    ğŸ¤–
  </div>

  <!-- AI Chat Modal -->
  <div id="ai-modal"
       class="fixed bottom-24 right-6 w-[360px] max-w-[90vw] bg-white rounded-2xl shadow-xl hidden flex flex-col overflow-hidden">

    <!-- Header -->
    <div class="bg-black text-white px-4 py-3 flex justify-between items-center">
      <span class="font-semibold">AI í•œì ì„ ìƒë‹˜</span>
      <button onclick="toggleAI()">âœ•</button>
    </div>

    <!-- Messages -->
    <div id="ai-messages" class="flex-1 p-4 overflow-y-auto text-sm">
      <div class="chat-bubble ai">
        ì•ˆë…•í•˜ì„¸ìš”! HSK í•œì ì„ ìƒë‹˜ì…ë‹ˆë‹¤ ğŸ˜Š  
        ê¶ê¸ˆí•œ í•œìë‚˜ ë‹¨ì–´ë¥¼ ì…ë ¥í•´ ë³´ì„¸ìš”.
      </div>
    </div>

    <!-- Input -->
    <div class="border-t p-3 flex gap-2">
      <input
        id="ai-input"
        type="text"
        class="flex-1 border rounded-full px-3 py-2 text-sm focus:outline-none"
        placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
        onkeydown="if(event.key==='Enter'){askAI()}"
      />
      <button
        id="ai-send-btn"
        onclick="askAI()"
        class="bg-orange-500 text-white px-4 rounded-full text-sm">
        ë³´ë‚´ê¸°
      </button>
    </div>

    <!-- Footer Hint -->
    <div class="text-[11px] text-center text-gray-500 pb-2">
      ğŸ” Key ë³´í˜¸ ëª¨ë“œ Â· /api/gemini ì‚¬ìš© ì¤‘
    </div>
  </div>

  <script>
    function toggleAI() {
      const modal = document.getElementById("ai-modal");
      modal.classList.toggle("hidden");
    }

    function addMessage(text, role) {
      const box = document.getElementById("ai-messages");
      const div = document.createElement("div");
      div.className = `chat-bubble ${role}`;
      div.textContent = text;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    async function askAI() {
      const input = document.getElementById("ai-input");
      const sendBtn = document.getElementById("ai-send-btn");
      const msg = (input.value || "").trim();
      if (!msg) return;

      addMessage(msg, "user");
      input.value = "";

      // ë²„íŠ¼ ì ì‹œ ë¹„í™œì„±í™”
      sendBtn.disabled = true;
      sendBtn.classList.add("opacity-60");

      try {
        const res = await fetch("/api/gemini", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg })
        });

        const data = await res.json();
        addMessage(data.text || "ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.", "ai");
      } catch (e) {
        addMessage("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.", "ai");
      } finally {
        // âœ… ë§¤ìš° ì¤‘ìš”: ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
        sendBtn.disabled = false;
        sendBtn.classList.remove("opacity-60");
      }
    }
  </script>

</body>
</html>
